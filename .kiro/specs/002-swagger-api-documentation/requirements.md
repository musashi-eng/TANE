# 要件定義書

## はじめに

本ドキュメントは、NestJS11バックエンドにSwagger（OpenAPI）ドキュメントを統合する要件を定義します。この機能により、開発者はAPIエンドポイントを視覚的に確認し、テストできるようになります。

## 用語集

- **Swagger**: RESTful APIを記述、生成、視覚化、テストするためのオープンソースフレームワーク
- **OpenAPI**: RESTful APIを記述するための標準仕様
- **Swagger UI**: OpenAPI仕様を視覚的に表示するWebインターフェース
- **API Documentation**: APIエンドポイント、パラメータ、レスポンスを説明するドキュメント
- **Decorator**: TypeScriptのメタデータを追加する構文（@で始まる）
- **DTO**: Data Transfer Object、データ転送オブジェクト
- **Backend Application**: NestJS11で構築されたバックエンドアプリケーション

## 要件

### 要件1: Swagger基本設定

**ユーザーストーリー:** 開発者として、バックエンドアプリケーションにSwaggerを統合したい。そうすることで、APIドキュメントを自動生成できる。

#### 受入基準

1. WHEN Backend Applicationが起動する THEN システムはSwagger UIを `/api` パスで提供する
2. THE システムは `@nestjs/swagger` パッケージを使用する
3. THE システムはOpenAPI 3.0仕様に準拠したドキュメントを生成する
4. WHEN 開発者が `http://localhost:3000/api` にアクセスする THEN システムはSwagger UIを表示する
5. THE システムはJSON形式のOpenAPI仕様を `/api-json` パスで提供する

### 要件2: API基本情報

**ユーザーストーリー:** 開発者として、API全体の基本情報を設定したい。そうすることで、APIの目的とバージョンを明確にできる。

#### 受入基準

1. THE システムはAPIタイトルを「Tama API」として設定する
2. THE システムはAPI説明を「タスク管理アプリケーションのバックエンドAPI」として設定する
3. THE システムはAPIバージョンを「1.0」として設定する
4. THE システムはAPIタグを使用してエンドポイントをグループ化する
5. WHEN Swagger UIが表示される THEN システムは設定された基本情報を表示する

### 要件3: エンドポイントドキュメント

**ユーザーストーリー:** 開発者として、各APIエンドポイントを自動的にドキュメント化したい。そうすることで、手動でドキュメントを書く手間を削減できる。

#### 受入基準

1. WHEN コントローラーにデコレーターが適用される THEN システムは自動的にエンドポイントをドキュメント化する
2. THE システムは各エンドポイントのHTTPメソッド（GET、POST、PUT、DELETE）を表示する
3. THE システムは各エンドポイントのパスを表示する
4. THE システムは各エンドポイントの説明を表示する
5. THE システムは各エンドポイントのタグを表示する

### 要件4: リクエストボディのドキュメント

**ユーザーストーリー:** 開発者として、APIリクエストボディの構造を明確にしたい。そうすることで、クライアント開発者が正しいデータ形式を理解できる。

#### 受入基準

1. WHEN DTOクラスにデコレーターが適用される THEN システムは自動的にリクエストボディをドキュメント化する
2. THE システムは各フィールドの名前を表示する
3. THE システムは各フィールドのデータ型を表示する
4. THE システムは各フィールドの説明を表示する
5. THE システムは必須フィールドと任意フィールドを区別して表示する
6. THE システムはフィールドの例示値を表示する

### 要件5: レスポンスのドキュメント

**ユーザーストーリー:** 開発者として、APIレスポンスの構造を明確にしたい。そうすることで、クライアント開発者が期待されるレスポンス形式を理解できる。

#### 受入基準

1. WHEN エンドポイントにレスポンスデコレーターが適用される THEN システムは自動的にレスポンスをドキュメント化する
2. THE システムは各HTTPステータスコード（200、201、400、404、500など）のレスポンスを表示する
3. THE システムは各レスポンスのデータ構造を表示する
4. THE システムは成功レスポンスと失敗レスポンスを区別して表示する
5. THE システムはレスポンスの説明を表示する

### 要件6: バリデーションルールのドキュメント

**ユーザーストーリー:** 開発者として、入力値のバリデーションルールをドキュメント化したい。そうすることで、クライアント開発者が有効な入力値の範囲を理解できる。

#### 受入基準

1. WHEN DTOクラスにバリデーションデコレーターが適用される THEN システムは自動的にバリデーションルールをドキュメント化する
2. THE システムは最小値と最大値の制約を表示する
3. THE システムは文字列長の制約を表示する
4. THE システムはパターン（正規表現）の制約を表示する
5. THE システムは列挙型（enum）の有効な値を表示する

### 要件7: Try it out機能

**ユーザーストーリー:** 開発者として、Swagger UIから直接APIをテストしたい。そうすることで、別のツールを使わずにAPIの動作を確認できる。

#### 受入基準

1. WHEN 開発者がSwagger UIで「Try it out」ボタンをクリックする THEN システムはリクエストパラメータの入力フォームを表示する
2. WHEN 開発者がパラメータを入力して「Execute」ボタンをクリックする THEN システムは実際のAPIリクエストを送信する
3. WHEN APIリクエストが完了する THEN システムはレスポンスボディを表示する
4. WHEN APIリクエストが完了する THEN システムはレスポンスヘッダーを表示する
5. WHEN APIリクエストが完了する THEN システムはHTTPステータスコードを表示する

### 要件8: 開発環境での有効化

**ユーザーストーリー:** 開発者として、開発環境でのみSwaggerを有効にしたい。そうすることで、本番環境でのセキュリティリスクを回避できる。

#### 受入基準

1. WHEN NODE_ENV環境変数が「development」である THEN システムはSwaggerを有効化する
2. WHEN NODE_ENV環境変数が「production」である THEN システムはSwaggerを無効化する
3. THE システムは環境変数による制御をmain.tsファイルで実装する
4. WHEN 本番環境でSwaggerパスにアクセスする THEN システムは404エラーを返す
5. THE システムは開発環境と本番環境で異なる動作をログに記録する

### 要件9: ヘルスチェックエンドポイントのドキュメント

**ユーザーストーリー:** 開発者として、既存のヘルスチェックエンドポイントをSwaggerでドキュメント化したい。そうすることで、システム監視の方法を明確にできる。

#### 受入基準

1. THE システムは `/health` エンドポイントをSwaggerでドキュメント化する
2. THE システムはヘルスチェックエンドポイントを「Health」タグでグループ化する
3. THE システムはヘルスチェックのレスポンス形式を明示する
4. THE システムはデータベース接続状態のチェック結果を含むレスポンス構造を表示する
5. WHEN ヘルスチェックが成功する THEN システムは200ステータスコードとその構造をドキュメント化する

